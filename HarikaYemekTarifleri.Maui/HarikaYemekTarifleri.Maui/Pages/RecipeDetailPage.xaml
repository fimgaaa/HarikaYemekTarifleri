<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HarikaYemekTarifleri.Maui.Pages.RecipeDetailPage"
             xmlns:controls="clr-namespace:Microsoft.Maui.Controls;assembly=Microsoft.Maui.Controls"
             x:Name="DetailPage"
             Title="Tarif Detayı">

    <controls:NavigationPage.TitleView>
		<Grid ColumnDefinitions="*,Auto"
              Padding="0,0,8,0"
              ColumnSpacing="8"
              VerticalOptions="Center"
              HorizontalOptions="FillAndExpand"
              WidthRequest="{Binding Source={x:Reference DetailPage}, Path=Width}"
              MinimumWidthRequest="{Binding Source={x:Reference DetailPage}, Path=Width}">
            <Label Text="Tarif Detayı"
                   FontAttributes="Bold"
                   FontSize="20"
                   VerticalOptions="Center"
                   HorizontalOptions="Start" />
			<Button Text="Düzenle"
		        Command="{Binding EditCommand}"
		        IsVisible="{Binding IsOwner}"
		        HorizontalOptions="End"
		        VerticalOptions="Center"
		        Grid.Column="1" />
        </Grid>
    </controls:NavigationPage.TitleView>
    
    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="10">
            <Image Source="{Binding Recipe.PhotoUrl, TargetNullValue='dotnet_bot.png'}" HeightRequest="200" />
            <Label Text="{Binding Recipe.Title}" FontAttributes="Bold" FontSize="Medium" />
            <Label Text="{Binding Recipe.Content}" />
            <Label Text="{Binding Recipe.CreatedAt, StringFormat='Oluşturulma Tarihi: {0:dd.MM.yyyy HH:mm}'}"
                   TextColor="Gray" />
            <Label Text="{Binding Recipe.PrepTime, StringFormat='Hazırlanma Süresi: {0:mm\\:ss}'}" />

            <Label Text="Yorumlar" FontAttributes="Bold" />
            <CollectionView ItemsSource="{Binding Comments}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="8" Margin="0,0,0,8" HasShadow="True">
                            <VerticalStackLayout>
                                <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                                    <Label Text="{Binding UserName, StringFormat='{0}:'}" FontAttributes="Bold" HorizontalOptions="StartAndExpand" />
                                    <Button Text="Sil"
                                            Command="{Binding Source={x:Reference DetailPage}, Path=BindingContext.DeleteCommentCommand}"
                                            CommandParameter="{Binding .}"
                                            IsVisible="{Binding IsMine}"
                                            HorizontalOptions="End"
                                            Padding="10,0"
                                            FontSize="12" />
                                </HorizontalStackLayout>
                                <Label Text="{Binding Text}" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Editor Placeholder="Yorum ekle..." Text="{Binding NewComment}" />
            <Button Text="Gönder" Command="{Binding AddCommentCommand}" />
            <Label Text="{Binding Error}" TextColor="Red" />

            <Label Text="Yazarın Diğer Tarifleri" FontAttributes="Bold" Margin="0,16,0,0" />
            <CollectionView ItemsSource="{Binding AuthorRecipes}"
                            SelectionMode="None"
                            HeightRequest="220">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame WidthRequest="160"
                               Padding="8"
                               Margin="0,0,12,0"
                               HasShadow="True">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={x:Reference DetailPage}, Path=BindingContext.OpenRecipeCommand}"
                                                      CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                            <VerticalStackLayout Spacing="6">
                                <Image Source="{Binding PhotoUrl, TargetNullValue='dotnet_bot.png'}"
                                       HeightRequest="100"
                                       Aspect="AspectFill" />
                                <Label Text="{Binding Title}"
                                       FontAttributes="Bold"
                                       LineBreakMode="TailTruncation" />
                                <Label Text="{Binding CreatedAt, StringFormat='{0:dd.MM.yyyy}'}"
                                       FontSize="12"
                                       TextColor="Gray" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>